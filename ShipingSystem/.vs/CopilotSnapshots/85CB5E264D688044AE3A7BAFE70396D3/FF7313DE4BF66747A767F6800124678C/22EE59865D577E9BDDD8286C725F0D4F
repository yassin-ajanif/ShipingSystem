@model List<DataAccessLayer.Models.TbCountry>
@{
    ViewData["Title"] = "Database Debug";
}

<div class="container mt-4">
    <h2>Database Connection Debug</h2>
    
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Connection Information</h5>
                </div>
                <div class="card-body">
                    <p><strong>Can Connect:</strong> @ViewBag.CanConnect</p>
                    <p><strong>Database Name:</strong> @ViewBag.DatabaseName</p>
                    <p><strong>Total Count:</strong> @ViewBag.TotalCount</p>
                </div>
            </div>
        </div>
    </div>
    
    @if (ViewBag.DebugInfo != null)
    {
        <div class="card mt-3">
            <div class="card-header">
                <h5>Detailed Debug Information</h5>
            </div>
            <div class="card-body">
                <ul>
                    @foreach (string info in ViewBag.DebugInfo)
                    {
                        <li>@info</li>
                    }
                </ul>
            </div>
        </div>
    }
    
    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger mt-3">
            <h4>Error:</h4>
            <p>@ViewBag.Error</p>
            @if (ViewBag.StackTrace != null)
            {
                <details>
                    <summary>Stack Trace</summary>
                    <pre>@ViewBag.StackTrace</pre>
                </details>
            }
        </div>
    }
    else
    {
        <div class="alert alert-info mt-3">
            <p>@ViewBag.Message</p>
        </div>
        
        @if (ViewBag.SqlQuery != null)
        {
            <div class="card mt-3">
                <div class="card-header">
                    <h5>SQL Query Generated by Entity Framework</h5>
                </div>
                <div class="card-body">
                    <pre style="background-color: #f8f9fa; padding: 10px; border-radius: 5px;">@ViewBag.SqlQuery</pre>
                </div>
            </div>
        }
        
        <h3 class="mt-4">Countries from TbCountries Table:</h3>
        
        @if (Model != null && Model.Any())
        {
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Country Arabic Name</th>
                        <th>Country English Name</th>
                        <th>Created Date</th>
                        <th>Current State</th>
                        <th>Created By</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var country in Model)
                    {
                        <tr>
                            <td>@country.Id</td>
                            <td>@(country.CountryAname ?? "N/A")</td>
                            <td>@(country.CountryEname ?? "N/A")</td>
                            <td>@country.CreatedDate.ToString("yyyy-MM-dd HH:mm:ss")</td>
                            <td>@country.CurrentState</td>
                            <td>@country.CreatedBy</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="alert alert-warning">
                <h5>No countries found!</h5>
                <p>This could mean:</p>
                <ul>
                    <li>Entity Framework is connecting to a different database than expected</li>
                    <li>The table name mapping is incorrect</li>
                    <li>There are permission issues</li>
                    <li>The records exist but have different column values than expected</li>
                </ul>
            </div>
        }
    }
    
    <div class="mt-4">
        <a href="@Url.Action("TestDatabase", "Home")" class="btn btn-secondary me-2">Simple Test</a>
        <a href="@Url.Action("DetailedDebug", "Home")" class="btn btn-info me-2">Detailed Debug</a>
        <a href="@Url.Action("Index", "Home")" class="btn btn-primary">Back to Home</a>
    </div>
</div>